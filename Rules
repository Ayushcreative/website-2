#!/usr/bin/env ruby

passthrough '/README.md'
passthrough '/assets/**/*'

compile '/**/*.md' do
  filter :erb
  filter :redcarpet, options: {filter_html: true, autolink: true, no_intraemphasis: true, fenced_code_blocks: true, gh_blockcode: true, tables: true}, renderer_options: {with_toc_data: true}
  filter :bootstrappify

  case
  when item.identifier =~ '/**/speakers/*'
    layout '/kind/speaker.html'
  when item.identifier =~ '/**/talks/*'
    layout '/kind/talk.html'
  end

  layout '/container.html'

  case
  when item.identifier =~ '/2016-berlin/*' || item.identifier == '/coc.md' || item.identifier == '/index.md'
    layout '/banner/2016-berlin.html'
  else
    layout '/banner/none.html'
  end

  layout '/default.html'
end

route '/**/*.md' do
  if item.identifier =~ '/**/index.*'
    item.identifier.without_ext + '.html'
  else
    item.identifier.without_ext + '/index.html'
  end
end

layout '/**/*', :erb
